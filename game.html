<!doctype html>
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto:700&display=swap" rel="stylesheet">
    <meta charset="utf-8">
    <title>COMP 20 - FINAL PROJECT</title>
    <style type="text/css">
      body, html {
        background-color: #454545;
        color: #FFF;
        font-family: 'Roboto', sans-serif;
        cursor: default;
      }
      .container {
        position: absolute;
        left: 50%;
        margin-left: -500px;
        top: 150px;
        width: 1000px;
        text-align: center;
      }
      #wordsContainer {
        position: relative;
        margin-bottom: 250px;
        margin-top: 35px;
      }
      .word {
        position: relative;
        display: inline;
        margin: 0px 10px;
        text-decoration: none;
        text-align: center;
        border-bottom: solid 7px #ad42ff;
      }
      .word_hover:hover {
        color: #ffd166;
      }
      h2 {
        font-size: 40px;
      }
      h3 {
        font-size: 30px;
      }
      h4 {
        font-size: 23px;
      }
      h5 {
        font-size: 17px;
      }
      #scoreContainer {
        text-align: center;
        position: absolute;
        width: 200px;
        top: 225px;
        left: -50px;
        background-color:
      }
      #livesContainer {
        text-align: center;
        position: absolute;
        width: 200px;
        top: 225px;
        right: -50px;;
      }
      #answersContainer {
        position: relative;
        margin-bottom: 30px;
      }
      .answerButton {
        width: 15%;
        color: #FFF;
        position: relative;
        background-color: #1f1f1f;
        border: solid 3px #1f1f1f;
        border-radius: 20px;
        padding: 16px 24px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16pt;
        margin: 0px 10px;
      }
      .answerButton_hover:hover {
        background: #808080;
        border: solid 3px #808080;
        border-radius: 20px;
        color: #f7f7f7;
        outline: none;
        cursor: pointer;
      }
      .answerButton:focus {
        outline: 0;
      }
      .nextButton {
        font-size: 12pt;
        padding: 12px 24px;
        visibility: hidden;
        position: relative;
        background-color: #ad42ff;
        border: solid 1px #ad42ff;
        color: #f7f7f7;
        border-radius: 15px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        margin: 10px 0px;
        cursor: pointer;
      }
      .nextButton:hover {
        background: #9000ff;
        border: solid 1px #9000ff;
        border-radius: 15px;
        color: #ebebeb;
        outline: none;
      }
      .nextButton:focus {
        outline: 0;
      }
      #currentScore {
        text-decoration: none;
      }
      #lives {
        text-decoration: none;
      }
      #feedback {
        font-family: 'Roboto', sans-serif;
        position: absolute;
        left: 50%;
        margin-left: -450px;
        top: 250px;
        width: 900px;
        text-align: center;
      }
      #instruct {
        position: absolute;
        left: 50%;
        width: 200px;
        margin-left: -100px;
        top: 470px;
        height: 20px;
      }
      .wrongButton {
        background-color: #d90024;
        border-color: #d90024;
      }
      .correctButton {
        background-color: #14b000;
        border-color: #14b000;
      }
      .definition {
        position: absolute;
        left: 50%;
        margin-left: -315px;
        top: 314px;
        width: 630px;
        height: 95px;
        background-color: #f7f7f7;
        visibility: hidden;
        text-align: center;
        color: #1f1f1f;
        border-radius: 20px;
      }
      .homeButton {
        position: absolute;
        background-color: #878787;
        border: solid 1px #878787;
        border-radius: 20px;
        color: #FFF;
        padding: 10px 10px;
        text-align: center;
        text-decoration: none;
        font-size: 12px;
        width: 110px;
        height: 40px;
        margin-left: 30px;
        left: 5%;
        top: 30px;
      }
      .homeButton_hover:hover {
        background: #a3a3a3;
        border: solid 1px #a3a3a3;
        border-radius: 20px;
        color: #FFF;
        outline: none;
        cursor: pointer;
      }
      .leaderboardButton {
        position: absolute;
        background-color: #878787;
        border: solid 1px #878787;
        border-radius: 20px;
        color: #FFF;
        padding: 10px 10px;
        text-align: center;
        text-decoration: none;
        font-size: 12px;
        width: 110px;
        height: 40px;
        top: 30px;
        right: 5%;
      }
      .leaderboardButton_hover:hover {
        background: #a3a3a3;
        border: solid 1px #a3a3a3;
        border-radius: 20px;
        color: #FFF;
        outline: none;
        cursor: pointer;
      }
      .score_box {
        top: 0px;
        position: absolute;
        width:300px;
        height:80px;
        left: 50%;
        margin-left: -150px;
        font-size: 40px;
      }
      .unique {
        position: absolute;
        height: 80px;
        width: 300px;
        left: 50%;
        margin-left: -150px;
        top: 250px;
      }
      #name_text{
        box-sizing: border-box;
        width: 300px;
        height: 20px;
        margin-bottom: 100px;
        padding: 20px 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
      .timerContainer {
        position: absolute;
        left: 50%;
        width: 600px;
        margin-left: -300px;
        top: 140px;
      }
      progress {
        width: 100%;
        height: 20px;
        color: #ad42ff;
        border-radius: 5px;
        -webkit-appearance: progress-bar;
      }
      progress::-webkit-progress-bar {
        width: 100%;
        height: 20px;
        border-radius: 5px;
        background-color: #5e5e5e;
      }
      progress::-webkit-progress-value {
        width: 100%;
        height: 20px;
        background-color: #ad42ff;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <div class="timerContainer">
      <progress class="time" id="time" value="0" max="5"></progress>
    </div>
    <input class="homeButton homeButton_hover" type="button" value="HOME" id="home" onclick="window.location.href = 'index.html';">
    <input class="leaderboardButton leaderboardButton_hover" type="button" value="LEADERBOARD" id="leaderboard" onclick="window.location.href = 'leaderboard.html';">
    <div class="container" id="container">
    <div class="container2" id="container2">
      <h5 id="instruct"></h5>
      <div id="wordsContainer">
        <h2><div class="word" id="word1">word1</div> and <div class="word" id="word2">word2</div> are: </h2>
      </div>
      <div id="answersContainer">
        <input class="answerButton answerButton_hover" type="button" value="Synonyms" id="synonyms" onclick="return answer(this.id);">
        <input class="answerButton answerButton_hover" type="button" value="Antonyms" id="antonyms" onclick="return answer(this.id);">
        <input class="answerButton answerButton_hover" type="button" value="Neither" id="neither" onclick="return answer(this.id);">
      </div>
      <input class="nextButton" id="nextButton" type="button" value="Continue" onclick="return next();">
      <div id="scoreContainer">
        <h3 id="scoreLine">Score: <ins id="currentScore">0</ins></h3>
      </div>
      <div id="livesContainer">
        <h3 id="livesLine">Lives: <ins id="lives">3</ins></h3>
      </div>
    </div>
    </div>
    <h2 id="feedback" style="height: 50px; font-size: 80px;"></h2>
    <div class="definition" id="definition"></div>

    <script language="javascript" type="text/javascript">
    var words = ["POLITE","BEAUTIFUL", "GORGEOUS", "HAPPY", "SAD", "UGLY",
                "UNHAPPY", "UNATTRACTIVE", "ATTRACTIVE", "HANDSOME", "CUTE",
                "SMART", "STUPID", "BIG", "TINY", "HUGE", "LUCKY", "UNLUCKY",
                "FUN", "FUNNY", "SCARY", "DUMB", "DIFFICULT", "EASY", "PLEASANT",
                "EXCITED", "PATHETIC", "HONORABLE", "INCORRECT", "MANY",
                "WORSE", "SUPERIOR", "ELEGANT", "SIMPLE", "LOUD", "QUIET", "PROPER",
                "SECURE", "HORRIBLE", "DISGUSTING", "SMOOTH", "HEALTHY", "RESPONSIBLE",
              "ACTIVE", "PASSIVE", "TERRIBLE"];
    var word1 = document.getElementById("word1");
    var word2 = document.getElementById("word2");
    var answerId;
    var currScore;
    var finalScore;
    var currLives;
    var synDisplay = document.getElementById("synonyms");
    var antDisplay = document.getElementById("antonyms");
    var neiDisplay = document.getElementById("neither");
    var nextDisplay = document.getElementById("nextButton");
    var defDisplay = document.getElementById("definition");
    var progressBar = document.getElementById("time");
    var defText1;
    var defText2;
    var w1choose = "";
    var w2choose = "";
    var correctAnswer = "NEITHER";
    var intervalTimer;

    function setWords() {
        document.getElementById("feedback").innerHTML = "";
        $.ajax({
          type: "GET",
          url: "https://www.dictionaryapi.com/api/v3/references/thesaurus/json/"+words[Math.floor(Math.random() * words.length)]+"?key=22b1d144-e9b9-42dc-aa2f-cea2b942e8d6",
          dataType: 'json',
          success: function(data) {
            w1choose = data[0].meta.syns[0][Math.floor(Math.random() * data[0].meta.syns[0].length)].toUpperCase();
          },
          async: false
        });
        var pick = Math.floor(Math.random() * 11) + 1;
        choosew2(w1choose, pick);
        if ((w2choose == "undefined") || (w2choose == "")) {
          w2choose = pickRandom(w1choose);
        }
        word1.innerHTML = w1choose;
        word2.innerHTML = w2choose;
        console.log("correctAnswer: " + correctAnswer);
        intervalTimer = function(){};
        timing();
      }

      function choosew2(w1choose, pick) {
        if (pick < 5) {                                                      // 4/11 chance of synonym
          if (synsExist(w1choose)) {
            w2choose = pickSynonym(w1choose);
            correctAnswer = "SYNONYMS";
          } else {
            //console.log("no synonyms, switch to pickRandom()")
            pick = 3;
          }
        }
        if (pick >= 5 && pick < 9) {                                         // 4/11 chance of antonym
          if (antsExist(w1choose)) {
            w2choose = pickAntonym(w1choose);
            correctAnswer = "ANTONYMS";
          } else {
            //console.log("no antonyms, switch to pickRandom()")
            pick = 3;
          }
        }
        if (pick >= 9) {                                                     // 3/11 chance of neither (less meaningful and slightly slower to run)
          correctAnswer = "NEITHER";
          w2choose = pickRandom();
          if (areSynonyms(w1choose, w2choose)) {
            correctAnswer = "SYNONYMS";
          }
          if (areAntonyms(w1choose, w2choose)) {
            correctAnswer = "ANTONYMS";
          }
        }
      }

      function synsExist(w) {
        var b = false;
        $.ajax({
          type: "GET",
          url: "https://www.dictionaryapi.com/api/v3/references/thesaurus/json/"+w+"?key="+"22b1d144-e9b9-42dc-aa2f-cea2b942e8d6",
          dataType: 'json',
          success: function(data) {
            if (data[0].meta.hasOwnProperty("syns")) {
              //console.log("3 hasOwnProperty true");
              if (data[0].meta.syns.status === undefined) {
                //console.log("2 status === undefined true");
                if (data[0].meta.syns.length != 0) {
                  //console.log("1 syns.length != 0 true");
                  //console.log("syns.length == " + data[0].meta.syns.length);
                  if (data[0].meta.syns[0].length != 0) {
                    //console.log("0 syns[0].length != 0 true");
                    //console.log("syns[0].length == " + data[0].meta.syns[0].length);
                    //console.log("synsExist true");
                    b = true;
                  }
                }
              }
            }
          },
          async: false
        });
        return b;
      }

      function antsExist(w) {
        var b = false;
        $.ajax({
          type: "GET",
          url: "https://www.dictionaryapi.com/api/v3/references/thesaurus/json/"+w+"?key="+"22b1d144-e9b9-42dc-aa2f-cea2b942e8d6",
          dataType: 'json',
          success: function(data) {
            if (data[0].meta.hasOwnProperty("ants")) {
              //console.log("3 hasOwnProperty true");
              if (data[0].meta.ants.status === undefined) {
                //console.log("2 status === undefined true");
                if (data[0].meta.ants.length != 0) {
                  //console.log("1 ants.length != 0 true");
                  //console.log("ants.length == " + data[0].meta.ants.length);
                  if (data[0].meta.ants[0].length != 0) {
                    //console.log("0 ants[0].length != 0 true");
                    //console.log("ants[0].length == " + data[0].meta.ants[0].length);
                    //console.log("antsExist true");
                    b = true;
                  }
                }
              }
            }
          },
          async: false
        });
        return b;
      }

      function pickSynonym(w) {
        //console.log("pickSynonym");
        var s;
        $.ajax({
          type: "GET",
          url: "https://www.dictionaryapi.com/api/v3/references/thesaurus/json/"+w+"?key=22b1d144-e9b9-42dc-aa2f-cea2b942e8d6",
          dataType: 'json',
          success: function(data) {
            s = JSON.stringify(data[0].meta.syns[0][Math.floor(Math.random() * data[0].meta.syns[0].length)]);
            //console.log(w + " syns: " + JSON.stringify(data[0].meta.syns[0]));
          },
          async: false
        });
        return s.toUpperCase().replace(/\"/g, "");
      }

      function pickAntonym(w) {
        //console.log("pickAntonym");
        var a;
        $.ajax({
          type: "GET",
          url: "https://www.dictionaryapi.com/api/v3/references/thesaurus/json/"+w+"?key=22b1d144-e9b9-42dc-aa2f-cea2b942e8d6",
          dataType: 'json',
          success: function(data) {
            if (data[0].meta.ants.length != 0) {
              if (data[0].meta.ants[0].length != 0) {
                a = JSON.stringify(data[0].meta.ants[0][Math.floor(Math.random() * data[0].meta.ants[0].length)]).toUpperCase().replace(/\"/g, "");
              } else {
                a = JSON.stringify(data[0].meta.ants[Math.floor(Math.random() * data[0].meta.ants.length)]);
              }
            }
          },
          async: false
        });
        return a.toUpperCase().replace(/\"/g, "");
      }

      function pickRandom() {
        //console.log("pickRandom");
        var n;
        $.ajax({
          type: "GET",
          url: "https://www.dictionaryapi.com/api/v3/references/thesaurus/json/"+words[Math.floor(Math.random() * words.length)]+"?key=22b1d144-e9b9-42dc-aa2f-cea2b942e8d6",
          dataType: 'json',
          success: function(data) {
            if (data[0].meta.syns.status === undefined) {
              n = data[0].meta.syns[0][Math.floor(Math.random() * data[0].meta.syns[0].length)];
            }
          },
          async: false
        });
        return n.toUpperCase().replace(/\"/g, "");
      }

    setWords();

    var showDef1 = function() {
      $.ajax({
        type: "GET",
        url: "https://www.dictionaryapi.com/api/v3/references/collegiate/json/" + word1.textContent + "?key=058036c9-eb04-4c41-b4b8-72de22609d84",
        dataType: 'json',
        async: false
      }).done(function(data) {
        defText = JSON.stringify(data[0].shortdef[0]).replace(/\"/g, "");
        defDisplay.innerHTML = "<h4 class='definitionText'>" + defText + "</h4>";
        defDisplay.style.visibility = "visible";
      })
    }

    var showDef2 = function() {
      $.ajax({
        type: "GET",
        url: "https://www.dictionaryapi.com/api/v3/references/collegiate/json/" + word2.textContent + "?key=058036c9-eb04-4c41-b4b8-72de22609d84",
        dataType: 'json',
        async: false
      }).done(function(data) {
        defText = JSON.stringify(data[0].shortdef[0]).replace(/\"/g, "");
        defDisplay.innerHTML = "<h4 class='definitionText'>" + defText + "</h4>";
        defDisplay.style.visibility = "visible";
      })
    }

    function answer(ansId) {
      $("#"+correctAnswer.toLowerCase()).addClass("correctButton");
      synDisplay.disabled = true;
      antDisplay.disabled = true;
      neiDisplay.disabled = true;
      $("#synonyms").removeClass("answerButton_hover");
      $("#antonyms").removeClass("answerButton_hover");
      $("#neither").removeClass("answerButton_hover");
      document.getElementById("instruct").innerHTML = "Hover over the words for their definitions!";
      $(".word").addClass("word_hover");
      word1.addEventListener("mouseover", showDef1);
      word2.addEventListener("mouseover", showDef2);
      $(".word").mouseout(function(){
        defDisplay.style.visibility = "hidden";
      })

      display = document.getElementById("feedback");
      if (ansId == "timesUp") {
        currLives = parseInt(document.getElementById("lives").textContent);
        currLives--;
        if (currLives > 0) {
          display.innerHTML = "⏳❌";                                                 // More than 0 lives, keep playing
          document.getElementById("lives").innerHTML = currLives;
          nextDisplay.style.visibility = "visible";
        } else {
        display.innerHTML = "❌GAME OVER❌";
        document.getElementById("lives").innerHTML = 0;                    // 0 lives, game over
        nextDisplay.setAttribute("onclick", "return game_end()")
        nextDisplay.style.visibility = "visible";
        finalScore = parseInt(document.getElementById("currentScore").textContent);
        }
      } else {
        answerId = ansId;

        if (answerId == correctAnswer.toLowerCase()) {
          $("#" + ansId).addClass("correctButton");

          display.innerHTML = "🧠✅";
          currScore = parseInt(document.getElementById("currentScore").textContent);
          currScore++;
          var newScore = (currScore).toString();
          document.getElementById("currentScore").innerHTML = newScore;
          nextDisplay.style.visibility = "visible";
        } else {
          $("#" + answerId).addClass("wrongButton");
          currLives = parseInt(document.getElementById("lives").textContent);
          currLives--;
          if (currLives > 0) {
            display.innerHTML = "👎❌";                                               // More than 0 lives, keep playing
            document.getElementById("lives").innerHTML = currLives;
            nextDisplay.style.visibility = "visible";
          } else {
            display.innerHTML = "❌GAME OVER❌";
            document.getElementById("lives").innerHTML = 0;                    // 0 lives, game over
            nextDisplay.setAttribute("onclick", "return game_end()")
            nextDisplay.style.visibility = "visible";
            finalScore = parseInt(document.getElementById("currentScore").textContent);
          }
        }
      }
    }

    function next() {
      word1.removeEventListener("mouseover", showDef1);
      word2.removeEventListener("mouseover", showDef2);
      document.getElementById("instruct").innerHTML = "";
      $(".word").removeClass("word_hover")
      $("#" + answerId).removeClass("wrongButton");                                 // Hide feedback
      $("#" + answerId).removeClass("correctButton");                               // Hide feedback
      $("#synonyms").addClass("answerButton_hover");                         // Allow hover on answerButtons
      $("#antonyms").addClass("answerButton_hover");                         // Allow hover on answerButtons
      $("#neither").addClass("answerButton_hover");                          // Allow hover on answerButtons
      synDisplay.disabled = false;                                           // answerButtons clickable again
      antDisplay.disabled = false;                                           // answerButtons clickable again
      neiDisplay.disabled = false;                                           // answerButtons clickable again
      nextDisplay.style.visibility = "hidden";
      $("#" + correctAnswer.toLowerCase()).removeClass("correctButton");
      setWords();
    }

    function areAntonyms(w1, w2) {
      var isAntonym = false;
      w1 = w1.toLowerCase();
      w2 = w2.toLowerCase();
      $.ajax({
        type: "GET",
        url: "https://www.dictionaryapi.com/api/v3/references/thesaurus/json/"+w1+"?key=22b1d144-e9b9-42dc-aa2f-cea2b942e8d6",
        dataType: 'json',
        success: function(data) {
          if (data[0].meta.ants.length != 0) {
            if (data[0].meta.ants[0].length != 0) {
              if (data[0].meta.ants[0].includes(w2)) {
                isAntonym = true;
              }
            } else {
              if (data[0].meta.ants.includes(w2)) {
                isAntonym = true;
              }
            }
          }
        },
        async: false
      });
      $.ajax({
        type: "GET",
        url: "https://www.dictionaryapi.com/api/v3/references/thesaurus/json/"+w2+"?key=22b1d144-e9b9-42dc-aa2f-cea2b942e8d6",
        dataType: 'json',
        success: function(data) {
          if (data[0].meta.ants.length != 0) {
            if (data[0].meta.ants[0].length != 0) {
              if (data[0].meta.ants[0].includes(w1)) {
                isAntonym = true;
              }
            } else {
              if (data[0].meta.ants.includes(w1)) {
                isAntonym = true;
              }
            }
          }
        },
        async: false
      });
      return isAntonym;
    }

    function areSynonyms(w1, w2) {
      var isSynonym = false;
      w1 = w1.toLowerCase();
      w2 = w2.toLowerCase();
      $.ajax({
        type: "GET",
        url: "https://www.dictionaryapi.com/api/v3/references/thesaurus/json/"+w1+"?key=22b1d144-e9b9-42dc-aa2f-cea2b942e8d6",
        dataType: 'json',
        success: function(data) {
          if ((data[0].meta.syns.status === undefined)) {
            if (data[0].meta.syns[0].includes(w2)) {
              isSynonym = true;
            }
          }
        },
        async: false
      });
      $.ajax({
        type: "GET",
        url: "https://www.dictionaryapi.com/api/v3/references/thesaurus/json/"+w2+"?key=22b1d144-e9b9-42dc-aa2f-cea2b942e8d6",
        dataType: 'json',
        success: function(data) {
          if ((data[0].meta.syns.status === undefined)) {
            if (data[0].meta.syns[0].includes(w1)) {
              isSynonym = true;
            }
          }
        },
        async: false
      });
      //console.log("areSynonyms end: isSynonym: " + isSynonym);
      return isSynonym;
    }

    var intervalTimer;

    function timing() {
      var timeLeft = 0;
      intervalTimer = setInterval(function() {
        document.getElementById("time").value = timeLeft;
        timeLeft += 0.01;
        if(timeLeft >= 5) {
          clearInterval(intervalTimer);
          answer("timesUp");
        }
      }, 10);
      $(".answerButton").click(
        function() {
          clearInterval(intervalTimer);
        }
      )
    }

      //ERIC'S GAME JAVASCRIPT ABOVE

      //DANNY'S DATABASE FUNCTIONS BELOW

      function game_end(){
          document.getElementById("wordsContainer").style.visibility = "hidden";
          document.getElementById("answersContainer").style.visibility = "hidden";
          document.getElementById("feedback").style.visibility = "hidden";
          document.getElementById("instruct").style.visibility = "hidden";
          document.getElementById("scoreContainer").style.visibility = "hidden";
          document.getElementById("livesContainer").style.visibility = "hidden";
          progressBar.style.visibility = "hidden";
          add_div();

      }

      function add_div(){

          $(document).ready(function(){
              $("#wordsContainer + #answersContainer").before($('<div class = "score_box" id = "user" name = "score"></div>'));
              var text1 = '<p>' + "Final Score:" + '</p>';
              $("#user").append(text1);
              $("#user").append(finalScore);

              $("#answersContainer + #nextButton").before($('<div class = "unique" id = "unique_name" name = "player_name"></div>'));
              var text2 = '<p>' + "Enter your name" + '</p>';
              $("#unique_name").append(text2);
              $("#unique_name").append('<input type = "text" id = "name_text" value = "Name">');

              $("#name_text").click(function(){
                  $("#name_text").val(" ");
              });




              nextDisplay.onclick = function () {
                  insert_mongo();
                  modify_continue();
                  location.href = "leaderboard.html";
              };
          });
      }

      function insert_mongo(){
          var user_id = $("#name_text").val();
          console.log("name is: " + user_id);

          var object = {name: user_id, score: finalScore};

          $.ajax({
              url: "mongodb+srv://dlee07:comp20@scores-qpnhf.mongodb.net/test?retryWrites=true&w=majority",
              method: "POST",
              contentType: "application/json",
              data: JSON.stringify(object),
          }).then(function (data){
                  console.log("Success");
          });
      }

      function modify_continue(){
          $("#user").remove();
          $("#unique_name").remove();

          var original = document.getElementById("nextButton").onclick;
          original = "return next();";
          $("#nextButton").attr("onclick", original);
      }

    </script>
  </body>
</html>
